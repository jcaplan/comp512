RM Logging:

assuming response time << timeout period && only one failure


No shadow stuff for TM but do implement a log and assume that it writes correctly


TM log events:


if received all votes and decided yes:
	commit that txn
else if started txn:
	abort that txn

2 situations: 	1. rm crashes during vote -> abort
				2. tm crashes during vote -> abort


start - crash 



TM crashes before sending votes
	-all txns time out and abort

Crash after sending vote and before receiving replies
	-Not possible in our implementation

Crash after receiving some replies but not all
	-Not possible in our implementation

Crash after deciding but before sending decision


TM: upon startup	-


RM:
Upon startup:
	if (tm.started(txn) && !tm.votedYes(txn)){
		abort txn;
	}

	if(tm.votedYest(txn) && !tm.committed(txn)

Upon start(id):
Upon commit(id):
Upon abort(id):
Upon vote(id):
	log (action,id)

single threaded environment:
	throw an error

	test: catches the error and makes a new object

web server:
	exit
	restart program


public interface Crash {
	
	public void crash() throws CrashException;
}

public class TestCrash implements Crash {
	
}

public class WSCrash implements Crash {
	
}


RMImplementation {

	Crash crash;

	int crashLocation = -1;

	setCrashLocation(int location)

	crash(int location){
		if(crashLocation = location){
			crash.crash();
		}
	}

	setCrashType(Crash c){
		crash = c;
	}

}



Crash after receive vote request but before sending answer
	-TM: txn aborts
	-RM: At startup check for started txns and abort ... clear stuff in TMServer


• Which answer to send (commit/abort)
	RM: must find txn id

• Crash after sending answer
	TM: TM must succeed in committing or aborting with all RMs
	RM: Should keep the record live at startup, and never timeout txn

• Crash after receiving decision but before committing/aborting
	same as after sending answer

• Recovery of RM; especially if it voted yes for a transaction but has not yet committed it.


Assign each crash location a number
setCrash(number)

at each site:

checkCrash(number)